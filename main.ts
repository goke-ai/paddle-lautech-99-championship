// on countdown end
info.onCountdownEnd(function () {
    if (info.score() > info.highScore() && info.score() >= 5) {
        game.setGameOverEffect(true, effects.confetti)
        game.gameOver(true)
    } else {
        game.setGameOverEffect(false, effects.dissolve)
        game.gameOver(false)
    }
})
// functions
function changeSpeed () {
    ballSprite.vx *= -1
ballSprite.vy *= -1
if (ballSprite.vx < 0) {
        ballSprite.vx = 0 - randint(50, 100)
        ballSprite.vy = 0 - randint(50, 100)
    } else {
        ballSprite.vx = randint(50, 100)
        ballSprite.vy = randint(50, 100)
    }
}
let ballSprite: Sprite = null
// setup
scene.setBackgroundColor(1)
scene.setBackgroundImage(assets.image`Logo`)
game.splash("You shall not pass!", "Paddle LAUTECH'99 Game")
game.showLongText("Stop the ball, score 5 and WIN!", DialogLayout.Bottom)
info.setScore(0)
info.startCountdown(30)
// sprites
// player sprite
let playerSprite = sprites.create(img`
    . . . . . a a a a a a . . . . . 
    . . . . . a a a a a a . . . . . 
    . . . . . a a a a a a . . . . . 
    . . . . . a a a a a a . . . . . 
    . . . . . a a a a a a . . . . . 
    . . . . . a a a a a a . . . . . 
    . . . . . a a a a a a . . . . . 
    . . . . . a a a a a a . . . . . 
    . . . . . a a a a a a . . . . . 
    . . . . . a a a a a a . . . . . 
    . . . . . a a a a a a . . . . . 
    . . . . . a a a a a a . . . . . 
    . . . . . a a a a a a . . . . . 
    . . . . . a a a a a a . . . . . 
    . . . . . a a a a a a . . . . . 
    . . . . . a a a a a a . . . . . 
    `, SpriteKind.Player)
playerSprite.setPosition(10, randint(20, 100))
controller.moveSprite(playerSprite, 0, 100)
playerSprite.setStayInScreen(true)
// ball sprite
ballSprite = sprites.create(img`
    . . . . . . . . . . . . . . . . 
    . . . . . . 4 4 4 4 . . . . . . 
    . . . . 4 4 4 5 5 4 4 4 . . . . 
    . . . 3 3 3 3 4 4 4 4 4 4 . . . 
    . . 4 3 3 3 3 2 2 2 1 1 4 4 . . 
    . . 3 3 3 3 3 2 2 2 1 1 5 4 . . 
    . 4 3 3 3 3 2 2 2 2 2 5 5 4 4 . 
    . 4 3 3 3 2 2 2 4 4 4 4 5 4 4 . 
    . 4 4 3 3 2 2 4 4 4 4 4 4 4 4 . 
    . 4 2 3 3 2 2 4 4 4 4 4 4 4 4 . 
    . . 4 2 3 3 2 4 4 4 4 4 2 4 . . 
    . . 4 2 2 3 2 2 4 4 4 2 4 4 . . 
    . . . 4 2 2 2 2 2 2 2 2 4 . . . 
    . . . . 4 4 2 2 2 2 4 4 . . . . 
    . . . . . . 4 4 4 4 . . . . . . 
    . . . . . . . . . . . . . . . . 
    `, SpriteKind.Player)
ballSprite.setPosition(randint(80, 160), randint(0, 120))
ballSprite.setVelocity(randint(50, 100), randint(50, 100))
ballSprite.setBounceOnWall(true)
// goalline sprite
let goalLineSprite = sprites.create(img`
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    22222
    `, SpriteKind.Player)
goalLineSprite.setPosition(0, 0)
// loop and overlap
forever(function () {
    if (playerSprite.overlapsWith(ballSprite)) {
        changeSpeed()
        info.changeScoreBy(1)
        music.play(music.melodyPlayable(music.powerUp), music.PlaybackMode.UntilDone)
    }
    if (goalLineSprite.overlapsWith(ballSprite)) {
        changeSpeed()
        info.changeScoreBy(-1)
        music.play(music.melodyPlayable(music.buzzer), music.PlaybackMode.UntilDone)
    }
})
